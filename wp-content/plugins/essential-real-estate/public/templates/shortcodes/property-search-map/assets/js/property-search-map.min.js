var ERE_Property_Map_Search=ERE_Property_Map_Search||{};(function(D){"use strict";var q=ere_search_map_vars.ajax_url;var a=ere_search_map_vars.price_is_slider;var A=ere_search_map_vars.item_amount;var N=ere_search_map_vars.marker_image_size;var Z=".ere-search-map-properties";var G=true;var J;var Q=[];var W=false;var F=true;var K;if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){F=false;W=true}ERE_Property_Map_Search={init:function(){var e=ere_search_map_vars.enable_filter_location;if(e=="1"){D(".ere-property-country-ajax",Z).select2();D(".ere-property-state-ajax",Z).select2();D(".ere-property-city-ajax",Z).select2();D(".ere-property-neighborhood-ajax",Z).select2()}this.full_screen();this.get_states_by_country();D(".ere-property-country-ajax",Z).on("change",function(){ERE_Property_Map_Search.get_states_by_country()});this.get_cities_by_state();D(".ere-property-state-ajax",Z).on("change",function(){ERE_Property_Map_Search.get_cities_by_state()});this.get_neighborhoods_by_city();D(".ere-property-city-ajax",Z).on("change",function(){ERE_Property_Map_Search.get_neighborhoods_by_city()});D(".btn-status-filter",Z).on("click",function(e){e.preventDefault();var a=D(this).data("value");D(this).parent().find("input").val(a);D(this).parent().find("button").removeClass("active");D(this).addClass("active");ERE_Property_Map_Search.change_price_on_status_change(a)});D('select[name="status"]',Z).on("change",function(e){e.preventDefault();var a=D(this).val();ERE_Property_Map_Search.change_price_on_status_change(a)});this.execute_url_search();D(".ere-sliderbar-filter.ere-sliderbar-price",Z).on("register.again",function(){D(".ere-sliderbar-filter.ere-sliderbar-price",Z).each(function(){var e=D(this);ERE_Property_Map_Search.set_slider_filter(e)})});this.register_slider_filter();this.set_slider_value();this.property_map_paging();this.search_map("map_only");D(".other-features-wrap .btn-other-features",Z).on("click",function(e){e.preventDefault();D(".other-features-list",Z).slideToggle();D(this).toggleClass("show");if(D(this).hasClass("show")==true){D('input[name="features-search"]',Z).attr("value","1");D(this).find("i").removeClass("fa-chevron-down");D(this).find("i").addClass("fa-chevron-up")}else{D('input[name="features-search"]',Z).attr("value","0");D(this).find("i").removeClass("fa-chevron-up");D(this).find("i").addClass("fa-chevron-down")}ERE_Property_Map_Search.search_map("map_and_content")});D(".ere-sliderbar-filter.ere-sliderbar-price",Z).on("register.again",function(){D(".ere-sliderbar-filter.ere-sliderbar-price",Z).each(function(){var e=D(this);ERE_Property_Map_Search.set_slider_filter(e)})});D(".ere-search-status-tab .btn-status-filter",Z).on("click",function(){D(this).parent().find("input").val(D(this).data("value"));D(this).parent().find("button").removeClass("active");D(this).addClass("active")});D('select[name="type"], select[name="bedrooms"],select[name="bathrooms"] , '+'select[name="garage"], select[name="label"],input[name="address"],input[name="title"],input[name="property_identity"], '+'select[name="min-price"], select[name="max-price"],select[name="min-area"], select[name="max-area"],select[name="min-land-area"], select[name="min-land-area"], '+'select[name="city"], select[name="country"], select[name="state"], select[name="neighborhood"]',Z).on("change",function(){ERE_Property_Map_Search.search_map("map_and_content")});D('input[name="other_features"]',Z).on("change",function(){ERE_Property_Map_Search.search_map("map_and_content")})},get_states_by_country:function(){var e=D(".ere-property-country-ajax",Z);if(e.length){var a=e.val();D.ajax({type:"POST",url:q,data:{action:"ere_get_states_by_country_ajax",country:a,type:1,is_slug:"1"},success:function(e){D(".ere-property-state-ajax",Z).html(e);var a=D(".ere-property-state-ajax",Z).attr("data-selected");if(typeof a!=="undefined"){D(".ere-property-state-ajax",Z).val(a)}}})}},get_cities_by_state:function(){var e=D(".ere-property-state-ajax",Z);if(e.length){var a=e.val();D.ajax({type:"POST",url:q,data:{action:"ere_get_cities_by_state_ajax",state:a,type:1,is_slug:"1"},success:function(e){D(".ere-property-city-ajax",Z).html(e);var a=D(".ere-property-city-ajax",Z).attr("data-selected");if(typeof a!=="undefined"){D(".ere-property-city-ajax",Z).val(a)}}})}},get_neighborhoods_by_city:function(){var e=D(".ere-property-city-ajax",Z);if(e.length){var a=e.val();D.ajax({type:"POST",url:q,data:{action:"ere_get_neighborhoods_by_city_ajax",city:a,type:1,is_slug:"1"},success:function(e){D(".ere-property-neighborhood-ajax",Z).html(e);var a=D(".ere-property-neighborhood-ajax",Z).attr("data-selected");if(typeof a!=="undefined"){D(".ere-property-neighborhood-ajax",Z).val(a)}}})}},execute_url_search:function(){D(".ere-advanced-search-btn",Z).on("click",function(e){e.preventDefault();var a=D(this).closest(".search-properties-form"),t=a.data("href"),o=[],r="?";if(t.indexOf("?")!==-1){r="&"}D(".search-field",a).each(function(){var e=D(this),a=e.attr("name"),t=e.val(),r=e.data("default-value");if(t!=r){o[a]=t}});D(".ere-sliderbar-filter",a).each(function(){var e=D(this),a=e.find(".min-input-request").attr("name"),t=e.find(".max-input-request").attr("name"),r=e.find(".min-input-request").val(),i=e.find(".max-input-request").val(),n=e.data("min-default"),s=e.data("max-default");if(r!=n||i!=s){o[a]=r;o[t]=i}});if(typeof o["features-search"]!="undefined"){var i="";D('[name="other_features"]',a).each(function(){var e=D(this),a=e.attr("value");if(e.is(":checked")){i+=a+";"}});if(i!==""){i=i.substring("0",i.length-1);o["other_features"]=i}}if(o!==[]){for(var n in o){if(o.hasOwnProperty(n)){r+=n+"="+o[n]+"&"}}}r=r.substring("0",r.length-1);window.location.href=t+r})},set_slider_filter:function(e){var t=e,a=parseInt(t.attr("data-min-default")),r=parseInt(t.attr("data-max-default")),i=t.attr("data-min"),n=t.attr("data-max"),s=t.find(".sidebar-filter"),o,l;s.slider({min:a,max:r,range:true,values:[i,n],slide:function(e,a){o=a.values[0];l=a.values[1];t.attr("data-min",o);t.attr("data-max",l);t.find("input.min-input-request").attr("value",o);t.find("input.max-input-request").attr("value",l);if(t.find("span").hasClass("not-format")){t.find("span.min-value").html(o);t.find("span.max-value").html(l)}else{t.find("span.min-value:not(.not-format)").html(ERE.number_format(o));t.find("span.max-value:not(.not-format)").html(ERE.number_format(l))}},stop:function(e,a){ERE_Property_Map_Search.search_map("map_and_content")}})},register_slider_filter:function(){D(".ere-sliderbar-filter",Z).each(function(){var e=D(this);ERE_Property_Map_Search.set_slider_filter(e)})},set_slider_value:function(){D(".ere-sliderbar-filter",Z).each(function(){var e=D(this),a=e.attr("data-min-default"),t=e.attr("data-max-default"),r=e.attr("data-min"),i=e.attr("data-max"),n=(r-a)/(t-a)*100+"%",s=(i-r)/(t-a)*100+"%",o=(i-a)/(t-a)*100+"%";e.find(".ui-slider-range.ui-corner-all.ui-widget-header").css({left:n,width:s});e.find(".ui-slider-handle.ui-corner-all.ui-state-default").css("left",n);e.find(".ui-slider-handle.ui-corner-all.ui-state-default:last-child").css("left",o)})},change_price_on_status_change:function(e){D.ajax({type:"POST",url:q,dataType:"json",data:{action:"ere_ajax_change_price_on_status_change",status:e,price_is_slider:a},success:function(e){if(e.slide_html){D(".ere-sliderbar-price-wrap",Z).html(e.slide_html);ERE_Property_Map_Search.register_slider_filter();ERE_Property_Map_Search.set_slider_value()}else{if(e.min_price_html){D('select[name="min-price"]',Z).html(e.min_price_html)}if(e.max_price_html){D('select[name="max-price"]',Z).html(e.max_price_html)}}ERE_Property_Map_Search.search_map("map_and_content")}})},full_screen:function(){if(D(".ere-search-map-properties").length>0){var e=D(window).outerHeight(),a=D("#wpadminbar").outerHeight();if(a==null){a=0}var t=D("header").outerHeight(),r=D("footer").outerHeight(),i=D(".wpadminbar").outerHeight(),n=e-a-t-r-i;D(".ere-search-map-properties .ere-map-search").css("height",n);D(".ere-search-map-properties .ere-map-search .ere-map-result").css("height",n);D(".col-scroll-vertical").css({height:n,"overflow-y":"scroll","overflow-x":"hidden"});var s=D(".property-vertical-map-listing",".list-property-result-ajax"),o=D(".property-item",s);s.css("opacity",1);s.imagesLoaded(function(){ERE.set_item_effect(o,"hide");o=D(".property-item",s);ERE.set_item_effect(o,"show")})}},property_map_paging:function(){G=true;D(".paging-navigation",".property-search-map-paging-wrap").each(function(){D("a",D(this)).off("click").on("click",function(e){e.preventDefault();var a=D(this);ERE_Property_Map_Search.search_map("map_and_content",a)})})},property_map_paging_control:function(){D(".paging-navigation",".property-search-map-paging-wrap").each(function(){var e=D(this);if(e.find("a.next").length===0){e.addClass("next-disable")}else{e.removeClass("next-disable")}})},search_map:function(d,e){var a,t,r,i,n,s,o,l,c,p,f,_,m,u,h,g,v,y,b,x,E,w;var P=D(Z);var R=P.find(".ere-map-result").attr("id");n=P.find('input[name="title"]').val();h=P.find('input[name="address"]').val();t=P.find('select[name="city"]').val();l=P.find('select[name="type"]').val();o=P.find('select[name="status"]').val();if(o==undefined){o=P.find('input[name="status"]').val()}c=P.find('select[name="bedrooms"]').val();p=P.find('select[name="bathrooms"]').val();if(D(".ere-sliderbar-price",P).length){f=P.find(".ere-sliderbar-filter.ere-sliderbar-price").attr("data-min");_=P.find(".ere-sliderbar-filter.ere-sliderbar-price").attr("data-max")}else{f=P.find('select[name="min-price"]').val();_=P.find('select[name="max-price"]').val()}if(D(".ere-sliderbar-area",P).length){m=P.find(".ere-sliderbar-filter.ere-sliderbar-area").attr("data-min");u=P.find(".ere-sliderbar-filter.ere-sliderbar-area").attr("data-max")}else{m=P.find('select[name="min-area"]').val();u=P.find('select[name="max-area"]').val()}if(D(".ere-sliderbar-land-area",P).length){b=P.find(".ere-sliderbar-filter.ere-sliderbar-land-area").attr("data-min");x=P.find(".ere-sliderbar-filter.ere-sliderbar-land-area").attr("data-max")}else{b=P.find('select[name="min-land-area"]').val();x=P.find('select[name="max-land-area"]').val()}r=P.find('select[name="state"]').val();a=P.find('select[name="country"]').val();i=P.find('select[name="neighborhood"]').val();y=P.find('select[name="label"]').val();g=P.find('select[name="garage"]').val();E=P.find('input[name="property_identity"]').val();w=P.find('input[name="features-search"]').val();if(w=="1"){v="";P.find(".other-features-list input[type=checkbox]:checked").each(function(){v+=D(this).val()+";"});if(v!=""){v=v.substring(0,v.length-1)}}var j=D("#ere_security_search_map").val(),S=D("#"+R);var M=null,C=ere_search_map_vars.googlemap_default_zoom,k=ere_search_map_vars.not_found,T=ere_search_map_vars.clusterIcon,L=ere_search_map_vars.google_map_style,O=ere_search_map_vars.pin_cluster_enable;var z={zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_CENTER},scrollwheel:false,scroll:{x:D(window).scrollLeft(),y:D(window).scrollTop()},zoom:parseInt(C),mapTypeId:google.maps.MapTypeId.ROADMAP,draggable:F,fullscreenControl:true,fullscreenControlOptions:{position:google.maps.ControlPosition.RIGHT_CENTER}};K=new InfoBox({disableAutoPan:true,maxWidth:310,alignBottom:true,pixelOffset:new google.maps.Size(-140,-55),zIndex:null,closeBoxMargin:"0 0 -16px -16px",infoBoxClearance:new google.maps.Size(1,1),isHidden:false,pane:"floatPane",enableEventPropagation:false});var I=function(e,p){D.each(e,function(e,a){var t=new google.maps.LatLng(a.lat,a.lng),r=a.marker_icon,i=new google.maps.Size(44,60);var n={url:r,size:i,scaledSize:new google.maps.Size(44,60),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(7,27)};var s=new google.maps.Marker({position:t,map:p,icon:n,draggable:false,animation:google.maps.Animation.DROP});var o=a.data?a.data.post_title:a.title,l="";if(a.image_url==""||typeof a.image_url=="undefined"){l='style="display: none;"'}var c=document.createElement("div");c.className="marker-content clearfix";c.innerHTML='<div class="marker-content-inner clearfix">'+'<div class = "item-thumb" '+l+">"+'<a href="'+a.url+'">'+'<img src="'+a.image_url+'" alt="'+o+'">'+"</a>"+"</div>"+'<div class="item-body">'+'<a href="'+a.url+'" class="title-marker">'+o+"</a>"+'<div class="price-marker">'+a.price+"</div>"+'<div class="address-marker"><i class="fa fa-map-marker"></i>'+a.address+"</div>"+"</div>"+"</div>";google.maps.event.addListener(s,"click",function(o,e){return function(){var e=Math.pow(2,p.getZoom()),a=100/e||0,t=p.getProjection(),r=o.getPosition(),i=t.fromLatLngToPoint(r),n=new google.maps.Point(i.x,i.y-a),s=t.fromPointToLatLng(n);p.setCenter(s);setTimeout(function(){K.setContent(c);K.open(p,o)},300)}}(s,e));Q.push(s)})};var B=1;if(e!=undefined){var H=e.attr("href");B=ERE.get_page_number_from_href(H)}D.ajax({dataType:"json",url:q,data:{action:"ere_property_search_map_ajax",title:n,address:h,country:a,state:r,city:t,neighborhood:i,type:l,status:o,bedrooms:c,bathrooms:p,min_price:f,max_price:_,min_area:m,max_area:u,label:y,garage:g,min_land_area:b,max_land_area:x,property_identity:E,features:v,search_type:d,paged:B,item_amount:A,marker_image_size:N,ere_security_search_map:j},beforeSend:function(){S.parents("div.ere-search-map-properties").find("#ere-map-loading").fadeIn()},success:function(e){if(d=="map_and_content"){var a=D(".property-vertical-map-listing"),t=D(".list-property-result-ajax");if(e.success===false){t.find(".title-result h2 .number-result").hide();t.find(".title-result h2 .text-no-result").show();t.find(".title-result h2 .text-result").hide();t.find(".property-vertical-map-listing").hide();t.find(".property-search-map-paging-wrap").hide()}else{var r=D(".property-item",e.property_html),i=D(".property-search-map-paging-wrap",e.property_html);a.css("opacity",0);a.html(r);ERE.set_item_effect(r,"hide");var n=a.offset().top-30;D("html,body").animate({scrollTop:+n+"px"},500);a.css("opacity",1);a.imagesLoaded(function(){r=D(".property-item",a);ERE.set_item_effect(r,"show");a.closest("div.list-property-result-ajax").find(".property-search-map-paging-wrap").html(i.html());ERE_Property_Map_Search.property_map_paging();ERE_Property_Map_Search.property_map_paging_control();ERE.favorite();ERE.tooltip();ERE_Compare.register_event_compare()});if(r.length!="0"){t.find(".title-result h2 .number-result").html(e.total_post);t.find(".title-result h2 .number-result").show();t.find(".title-result h2 .text-no-result").hide();t.find(".title-result h2 .text-result").show();t.find(".property-vertical-map-listing").show();t.find(".property-search-map-paging-wrap").show()}}}G=true;J=new google.maps.Map(document.getElementById(R),z);J.set("scrollwheel",false);google.maps.event.trigger(J,"resize");if(e.success===true){if(e.properties){var s=e.properties.length}}if(s==1){var o=google.maps.event.addListener(J,"bounds_changed",function(e){this.setZoom(parseInt(C));google.maps.event.removeListener(o)})}if(L!==""){var l=JSON.parse(L);J.setOptions({styles:l})}var c=new google.maps.LatLng("","");J.setCenter(c);J.setZoom(parseInt(C));google.maps.event.addListener(J,"tilesloaded",function(){D("#ere-map-loading").fadeOut()});if(e.success===true){for(var p=0;p<Q.length;p++){Q[p].setMap(null)}Q=[];I(e.properties,J);J.fitBounds(Q.reduce(function(e,a){return e.extend(a.getPosition())},new google.maps.LatLngBounds));google.maps.event.trigger(J,"resize");if(O=="1"){M=new MarkerClusterer(J,Q,{gridSize:60,styles:[{url:T,width:48,height:48,textColor:"#fff"}]})}if(!W){U()}}else{S.empty().html('<div class="map-notfound">'+k+"</div>")}S.closest("div.ere-search-map-properties").find("#ere-map-loading").fadeOut("slow")},error:function(){S.closest("div.ere-search-map-properties").find("#ere-map-loading").fadeOut("slow");G=true}})}};var U=function(){D(".property-item",Z).each(function(e){D(this).on("mouseenter",function(){if(J){google.maps.event.trigger(Q[e],"click")}});D(this).on("mouseleave",function(){K.open(null,null)})});return false};D(document).ready(function(){ERE_Property_Map_Search.init()});D(window).resize(function(){ERE_Property_Map_Search.full_screen()});D(window).on("orientationchange",function(){ERE_Property_Map_Search.full_screen()});D("body").keydown(function(e){if(e.which==35||e.which==34){D(".col-scroll-vertical").animate({scrollTop:D(".col-scroll-vertical-inner").height()},"slow");return false}else if(e.which==36||e.which==33){D(".col-scroll-vertical").animate({scrollTop:0},"slow");return false}})})(jQuery);