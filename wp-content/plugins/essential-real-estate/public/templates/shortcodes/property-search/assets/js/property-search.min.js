var ERE_Property_Search=ERE_Property_Search||{};(function(o){"use strict";var a=ere_search_vars.ajax_url;var t=ere_search_vars.price_is_slider;var r=".ere-search-properties";ERE_Property_Search={init:function(){var e=ere_search_vars.enable_filter_location;if(e=="1"){o(".ere-property-country-ajax",r).select2();o(".ere-property-state-ajax",r).select2();o(".ere-property-city-ajax",r).select2();o(".ere-property-neighborhood-ajax",r).select2()}this.get_states_by_country();o(".ere-property-country-ajax",r).on("change",function(){ERE_Property_Search.get_states_by_country()});this.get_cities_by_state();o(".ere-property-state-ajax",r).on("change",function(){ERE_Property_Search.get_cities_by_state()});this.get_neighborhoods_by_city();o(".ere-property-city-ajax",r).on("change",function(){ERE_Property_Search.get_neighborhoods_by_city()});o(".btn-status-filter",r).on("click",function(e){e.preventDefault();var t=o(this).data("value");o(this).parent().find("input").val(t);o(this).parent().find("button").removeClass("active");o(this).addClass("active");ERE_Property_Search.change_price_on_status_change(t)});o('select[name="status"]',r).on("change",function(e){e.preventDefault();var t=o(this).val();ERE_Property_Search.change_price_on_status_change(t)});this.execute_url_search();o(".ere-sliderbar-filter.ere-sliderbar-price",r).on("register.again",function(){o(".ere-sliderbar-filter.ere-sliderbar-price",r).each(function(){var e=o(this);ERE_Property_Search.set_slider_filter(e)})});this.register_slider_filter();this.set_slider_value();o(".other-features-wrap .btn-other-features",r).on("click",function(e){e.preventDefault();o(".other-features-list",r).slideToggle();o(this).toggleClass("show");if(o(this).hasClass("show")==true){o('input[name="features-search"]',r).attr("value","1");o(this).find("i").removeClass("fa-chevron-down");o(this).find("i").addClass("fa-chevron-up")}else{o('input[name="features-search"]',r).attr("value","0");o(this).find("i").removeClass("fa-chevron-up");o(this).find("i").addClass("fa-chevron-down")}})},get_states_by_country:function(){var e=o(".ere-property-country-ajax",r);if(e.length){var t=e.val();o.ajax({type:"POST",url:a,data:{action:"ere_get_states_by_country_ajax",country:t,type:1,is_slug:"1"},success:function(e){o(".ere-property-state-ajax",r).html(e);var t=o(".ere-property-state-ajax",r).attr("data-selected");if(typeof t!=="undefined"){o(".ere-property-state-ajax",r).val(t)}}})}},get_cities_by_state:function(){var e=o(".ere-property-state-ajax",r);if(e.length){var t=e.val();o.ajax({type:"POST",url:a,data:{action:"ere_get_cities_by_state_ajax",state:t,type:1},success:function(e){o(".ere-property-city-ajax",r).html(e);var t=o(".ere-property-city-ajax",r).attr("data-selected");if(typeof t!=="undefined"){o(".ere-property-city-ajax",r).val(t)}}})}},get_neighborhoods_by_city:function(){var e=o(".ere-property-city-ajax",r);if(e.length){var t=e.val();o.ajax({type:"POST",url:a,data:{action:"ere_get_neighborhoods_by_city_ajax",city:t,type:1,is_slug:"1"},success:function(e){o(".ere-property-neighborhood-ajax",r).html(e);var t=o(".ere-property-neighborhood-ajax",r).attr("data-selected");if(typeof t!=="undefined"){o(".ere-property-neighborhood-ajax",r).val(t)}}})}},execute_url_search:function(){o(".ere-advanced-search-btn",r).on("click",function(e){e.preventDefault();var t=o(this).closest(".search-properties-form"),a=t.data("href"),c=[],r="?";if(a.indexOf("?")!==-1){r="&"}o(".search-field",t).each(function(){var e=o(this),t=e.attr("name"),a=e.val(),r=e.data("default-value");if(a!=r){c[t]=a}});o(".ere-sliderbar-filter",t).each(function(){var e=o(this),t=e.find(".min-input-request").attr("name"),a=e.find(".max-input-request").attr("name"),r=e.find(".min-input-request").val(),i=e.find(".max-input-request").val(),n=e.data("min-default"),s=e.data("max-default");if(r!=n||i!=s){c[t]=r;c[a]=i}});if(typeof c["features-search"]!="undefined"){var i="";o('[name="other_features"]',t).each(function(){var e=o(this),t=e.attr("value");if(e.is(":checked")){i+=t+";"}});if(i!==""){i=i.substring("0",i.length-1);c["other_features"]=i}}if(c!==[]){for(var n in c){if(c.hasOwnProperty(n)){r+=n+"="+c[n]+"&"}}}r=r.substring("0",r.length-1);window.location.href=a+r})},set_slider_filter:function(e){var a=e,t=parseInt(a.attr("data-min-default")),r=parseInt(a.attr("data-max-default")),i=a.attr("data-min"),n=a.attr("data-max"),s=a.find(".sidebar-filter"),c,o;s.slider({min:t,max:r,range:true,values:[i,n],slide:function(e,t){c=t.values[0];o=t.values[1];a.attr("data-min",c);a.attr("data-max",o);a.find("input.min-input-request").attr("value",c);a.find("input.max-input-request").attr("value",o);if(a.find("span").hasClass("not-format")){a.find("span.min-value").html(c);a.find("span.max-value").html(o)}else{a.find("span.min-value:not(.not-format)").html(ERE.number_format(c));a.find("span.max-value:not(.not-format)").html(ERE.number_format(o))}},stop:function(e,t){}})},register_slider_filter:function(){o(".ere-sliderbar-filter",r).each(function(){var e=o(this);ERE_Property_Search.set_slider_filter(e)})},set_slider_value:function(){o(".ere-sliderbar-filter",r).each(function(){var e=o(this),t=e.attr("data-min-default"),a=e.attr("data-max-default"),r=e.attr("data-min"),i=e.attr("data-max"),n=(r-t)/(a-t)*100+"%",s=(i-r)/(a-t)*100+"%",c=(i-t)/(a-t)*100+"%";e.find(".ui-slider-range.ui-corner-all.ui-widget-header").css({left:n,width:s});e.find(".ui-slider-handle.ui-corner-all.ui-state-default").css("left",n);e.find(".ui-slider-handle.ui-corner-all.ui-state-default:last-child").css("left",c)})},change_price_on_status_change:function(e){o.ajax({type:"POST",url:a,dataType:"json",data:{action:"ere_ajax_change_price_on_status_change",status:e,price_is_slider:t},success:function(e){if(e.slide_html){o(".ere-sliderbar-price-wrap",r).html(e.slide_html);ERE_Property_Search.register_slider_filter();ERE_Property_Search.set_slider_value()}else{if(e.min_price_html){o('select[name="min-price"]',r).html(e.min_price_html)}if(e.max_price_html){o('select[name="max-price"]',r).html(e.max_price_html)}}}})}};o(document).ready(function(){ERE_Property_Search.init()})})(jQuery);